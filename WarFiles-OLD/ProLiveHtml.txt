<!DOCTYPE html>
<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>

$("#text").keypress(function(e) {
	console.log(document.getElementById("text").selectionStart);
	$.post("edit",
	{
		type: "PUT",
		key: e.key,
		keyCode: e.keyCode,
		position: document.getElementById("text").selectionStart,
		text: $("#text").text()
	},
	function(data, status){
		updateText(data);
		updatePos(data);
	});
});


$("#text").click(function(){
	var loc = $("#text").prop("selectionStart");
	console.log("working");
	console.log(loc);
	$.post("edit",
	{
		type: "CURSOR",
		position: document.getElementById("text").selectionStart
	},
	function(data, status){
		updatePos(data);
	});
});


function loop(){
	$.post("edit",
	{
		type: "GET",
		position: document.getElementById("text").selectionStart
	},
	function(data, status){
		updateText(data);
		setTimeout(loop(),10);
	});
}

setTimeout(loop(),2000);

function updateText(data){
	var index = data.lastIndexOf(",");
	var text = data.substring(0,index);
	$("#text").text(text);
}

function updatePos(data){
	var index = data.lastIndexOf(",");
	var position = data.substring(index + 1);
	document.getElementById("text").selectionStart = position;
}

</script>
</head>
<body>
<textarea rows="4" cols="50" name="file" id="text">@@</textarea>
</body>
</html>